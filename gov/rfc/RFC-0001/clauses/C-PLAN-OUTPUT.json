{
  "clause_id": "C-PLAN-OUTPUT",
  "title": "Planning and Output Modes",
  "kind": "normative",
  "status": "active",
  "text": "The CLI MUST provide a planning mode that performs no filesystem mutation and reports intended actions. This mode MUST be exposed as `--plan`.\n\nIf `--plan` is active, execution MUST terminate before any write operation.\n\nThe CLI MUST support `--output human|json|jsonl` for both planning and execution modes.\n\nFor machine-readable output (`json` and `jsonl`), the schema contract is normative:\n- The schema version MUST be included as `schema_version` and MUST be the string `\"1.0\"`.\n- Output mode MUST be represented by `mode` and MUST be one of `\"plan\"` or `\"execute\"`.\n- The effective configuration MUST be included via `effective_config`.\n\nJSON mode requirements:\n- JSON output MUST emit one top-level object.\n- The top-level object MUST include keys `schema_version`, `mode`, `effective_config`, and `items`.\n\nJSONL mode requirements:\n- JSONL output MUST emit one object per line and each line MUST include keys `schema_version` and `record_type`.\n- JSONL output MUST emit exactly one `record_type: \"effective_config\"` record before any item records.\n\nPlanning item requirements (`mode = \"plan\"`):\n- Each item MUST include `source`, `destination`, `action`, and `reason`.\n- `action` MUST be one of: `copy`, `skip`, `overwrite`, `error`.\n- `reason` MUST be one of: `not_exists`, `exists`, `newer_or_same`, `filtered`, `policy_blocked`, `invalid_input`.\n- In JSONL planning output, item records MUST use `record_type: \"plan_item\"`.\n\nExecution item requirements (`mode = \"execute\"`):\n- Each item MUST include `source`, `destination`, and `outcome`.\n- `outcome` MUST be one of: `copied`, `skipped`, `failed`.\n- If `outcome = \"copied\"`, the item MUST include `bytes_copied`.\n- If `outcome = \"failed\"`, the item MUST include `error_code` and `error_message`.\n- Failure `error_code` values MUST follow [RFC-0001:C-ERROR-MODEL].\n- If low-level platform information is provided, it MUST be nested under optional `error_detail`.\n- In JSONL execution output, item records MUST use `record_type: \"execute_item\"`.\n\n`--dry-run` MAY be kept as an alias for `--plan` during migration, but `--plan` MUST be the canonical name in documentation.\n\n**Rationale:**\nModern tooling requires inspectable intent before execution and strict machine contracts for automation and CI integration in both planning and execution paths.",
  "since": "0.1.0"
}
